{#
/**
 * @file
 * Template for displaying workflow information on the workflow tab.
 *
 * Available variables:
 * - tasks: Array of workflow_task entities.
 * - node: The node entity.
 * - can_edit: Boolean indicating if user can create/edit workflow tasks.
 * - can_administer: Boolean indicating if user can administer workflows.
 */
#}
<div class="workflow-tab-content">
  <div class="workflow-section">
    <h3>{{ 'Workflow Tasks'|t }}</h3>

    {% if tasks is not empty %}
      <p class="workflow-help-text">
        {% if can_administer %}
          {{ 'Click on a task to edit. Drag rows to reorder.'|t }}
        {% endif %}
      </p>
      <table class="workflow-tasks-table" id="workflow-tasks-table">
        <thead>
          <tr>
            <th>{{ '#'|t }}</th>
            <th>{{ 'Task'|t }}</th>
            <th>{{ 'Assigned To'|t }}</th>
            <th>{{ 'Status'|t }}</th>
            <th>{{ 'Due Date'|t }}</th>
            {% if can_administer %}
              <th>{{ 'Actions'|t }}</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for task in tasks %}
            {% set status_class = {
              'pending': 'status-pending',
              'in_progress': 'status-in-progress',
              'completed': 'status-completed',
              'skipped': 'status-skipped'
            } %}
            {% set status_labels = {
              'pending': 'Pending'|t,
              'in_progress': 'In Progress'|t,
              'completed': 'Completed'|t,
              'skipped': 'Skipped'|t
            } %}
            <tr data-task-id="{{ task.id() }}" class="task-row {{ status_class[task.getStatus()]|default('') }}">
              <td class="task-weight">{{ task.getWeight() + 1 }}</td>
              <td class="task-title">
                <strong>{{ task.label() }}</strong>
                {% if task.getDescription() %}
                  <div class="task-description text-muted">
                    {{ task.getDescription()|length > 100 ? task.getDescription()|slice(0, 100) ~ '...' : task.getDescription() }}
                  </div>
                {% endif %}
              </td>
              <td class="task-assigned">
                {% set assigned_type = task.getAssignedType() %}
                {% set assigned_label = task.getAssignedLabel() %}
                {% if assigned_type and assigned_label %}
                  {% set type_class = {
                    'user': 'assigned-user',
                    'group': 'assigned-group',
                    'destination': 'assigned-destination'
                  } %}
                  <span class="assigned-entity {{ type_class[assigned_type]|default('') }}">
                    {{ assigned_label }}
                  </span>
                {% else %}
                  <span class="text-muted">{{ 'Unassigned'|t }}</span>
                {% endif %}
              </td>
              <td class="task-status">
                <span class="status-badge {{ status_class[task.getStatus()]|default('') }}">
                  {{ status_labels[task.getStatus()]|default(task.getStatus()) }}
                </span>
              </td>
              <td class="task-due-date">
                {% if task.due_date.value %}
                  {{ task.due_date.value|date('M j, Y') }}
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
              </td>
              {% if can_administer %}
                <td class="task-actions">
                  <a href="{{ path('entity.workflow_task.edit_form', {'workflow_task': task.id()}) }}" class="button button--small">
                    {{ 'Edit'|t }}
                  </a>
                </td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="no-workflow-message">
        <div class="empty-state-icon">&#128203;</div>
        <h4>{{ 'No workflow tasks'|t }}</h4>
        <p>{{ 'No workflow tasks have been created for this content yet.'|t }}</p>
        {% if can_edit %}
          <p>{{ 'Click the button below to add workflow tasks.'|t }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% if can_edit %}
      <div class="workflow-actions">
        <a href="{{ path('entity.workflow_task.add_for_node', {'node': node.id()}) }}" class="button button--primary">
          {{ 'Add Task'|t }}
        </a>
        {% if can_administer %}
          <a href="{{ path('workflow_assignment.apply_template', {'node': node.id()}) }}" class="button">
            {{ 'Apply Template'|t }}
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
